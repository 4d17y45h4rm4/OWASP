# Testing for Client Side SQL Injection

<!-- The SQLi tests require a Title update to be uniform-->

## Summary

Client-side SQL injection occurs when an application implements the [Web SQL Database](https://www.w3.org/TR/webdatabase/) technology and doesn't properly validate the input nor parametrize its query variables. This DataBase (DB) is manipulated by using JavaScript (JS) API calls, such as `openDatabase()`, which creates or opens an existing database.

## Test Objectives

The following test scenario will validate that proper input validation is conducted. If the implementation is vulnerable, the attacker is able to extract the database information, manipulate it, or delete it.

## How to Test

### Identify the Usage of Web SQL DB

If the tested application implements the Web SQL DB, the following three calls are bound to exist:

- `openDatabase`
- `transaction`
- `executeSQL`

```javascript
// Code example containing them

var db = openDatabase(shortName, version, displayName, maxSize);

db.transaction(function(transaction) {
    transaction.executeSql('INSERT INTO LOGS (time, id, log) VALUES (?, ?, ?)', [dateTime, id, log];
));
```

### Web SQL DB Injection

After validating the existence of a `executeSQL` [sink](https://github.com/wisec/domxsswiki/wiki/Sinks), the attacker is ready to test and validate the security of its implementation.

Since the Web SQL DB employs SQLite's SQL dialect, the attack scenarios will be based on SQLite injection attacks.

#### Bypassing Conditions

```javascript
// URL example: https://example.com/user#15
var userId = document.location.hash.substring(1,); // Grabs the ID without the hash -> 15

db.transaction(function(transaction){
    transaction.executeSQL('SELECT * FROM users WHERE user = ' + userId);
});
```

To grab all the users, instead of only the user corresponding to the attacker, the following could be used: `15 OR 1=1` in the URL fragment.

For additional SQL Injection payloads, go to the [Testing for SQL Injection](4.8.5_Testing_for_SQL_Injection_WSTG-INPVAL-005.md) scenario.

## Remediation

Follow the same remediation from the [Testing for SQL Injection's Remediation Section](4.8.5_Testing_for_SQL_Injection_WSTG-INPVAL-005.md#remediation).

## References

[W3C Web SQL Database](https://www.w3.org/TR/webdatabase/)
[Apple's JavaScript Database Tutorial](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/UsingtheJavascriptDatabase/UsingtheJavascriptDatabase.html)
[Tutorialspoint HTML5 Web SQL Database](https://www.tutorialspoint.com/html5/html5_web_sql.htm)
[Portswigger's Client-Side SQL Injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)
